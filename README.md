# 📡🔗 iot-trace-chain

Hybrid architecture combining IoT, blockchain, and big data for secure traceability of waste data.

---

## 🧠 Overview

This project is part of a Master's Thesis and proposes a scalable architecture to ensure the traceability, integrity, and availability of data generated by IoT devices in waste management scenarios.

The solution combines:

- 🔧 IoT devices connected via MQTT
- 📦 Massive storage in Parquet format on a Data Lake (MinIO + Delta Lake)
- 🔐 Integrity verification using Merkle trees and blockchain (Ethereum/Hardhat)
- 📊 Optional visualization and analysis with DuckDB, Dremio, or other tools

---

## 🧱 Architecture

```plaintext
[IoT Device] --> MQTT --> Persistence Worker --> 
    [Delta Lake (MinIO)] + [Blockchain (Merkle Root)]
```

---

## 🚀 Main Services (Docker Compose)

| Service              | Description                                        |
|----------------------|----------------------------------------------------|
| `persistence-worker` | Processes, validates, and stores IoT data          |
| `minio`              | S3-compatible storage backend for the Data Lake    |
| `hardhat-node`       | Local blockchain node (Ethereum)                   |
| `mosquitto`          | MQTT broker receiving sensor messages              |
| `duckdb`             | Optional tools for data exploration and querying   |

---

## 📦 Project Structure

```
.
├── persistence-worker/       # Main worker code (Python, Spark)
├── blockchain/               # Smart contracts and Hardhat scripts
├── mosquitto/                # MQTT broker configuration
├── minio-mirror/             # Local copy for DuckDB querying
├── docker-compose.yaml       # Service orchestration
└── README.md                 # This file -> Project documentation
```

---

## 🛠 Technologies

- Python 3.12
- Apache Spark + PySpark
- Delta Lake
- MQTT (Eclipse Mosquitto)
- Ethereum + Hardhat
- MinIO (S3-compatible)
- DuckDB / Dremio (optional)
- Docker Compose

---

## ⚙️ Quick Start

### 🔧 Start environment:

```bash
docker compose up --build
```

### 📦 Run a manual service (e.g., MQTT Explorer):

```bash
docker compose --profile manual up mqtt-explorer
```

### 🐍 Run the worker manually:

```bash
cd persistence-worker
poetry install
poetry run poe start-local
```

If you want to run the worker with time of function execution, you can use the following command:

```bash
poetry run poe start-local-profiling
```

Additionally, if you want to send a test MQTT message, you can do so with the following command:

```bash
poetry run poe publish-message
```

---

## 📚 Documentation

TODO

## 📄 License

This project is licensed under the MIT License and developed as part of the [Master's in Business Intelligence and Big Data in Secure Environments (UBu, ULe, UVa)](https://www.inf.uva.es/master-online/) in Spain. 

---

## 👨‍🎓 Author

Javier Alonso-Núñez  
[LinkedIn](https://www.linkedin.com/in/javier0alonso/) • [GitHub](https://github.com/javalon) • [ORCID](https://orcid.org/0009-0004-3085-5007)

